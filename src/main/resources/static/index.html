<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DBæ¥ç¶šç¢ºèªãƒšãƒ¼ã‚¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status {
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .data-display {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            border: 1px solid #dee2e6;
        }
        .user-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .timestamp {
            color: #6c757d;
            font-size: 0.9em;
        }
        .form-group {
            margin: 15px 0;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .form-group input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            height: 100px;
            resize: vertical;
        }
    </style>
</head>
<body>
    <h1>ğŸš€ DBæ¥ç¶šç¢ºèªãƒšãƒ¼ã‚¸</h1>
    
    <div class="container">
        <h2>ğŸ“Š æ¥ç¶šçŠ¶æ³</h2>
        <div id="connectionStatus" class="status info">
            æ¥ç¶šç¢ºèªä¸­...
        </div>
        <button onclick="checkConnection()">æ¥ç¶šç¢ºèª</button>
        <button onclick="getUsers()">ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—</button>
        <button onclick="getLogs()">ãƒ­ã‚°ä¸€è¦§å–å¾—</button>
    </div>

    <div class="container">
        <h2>ğŸ‘¥ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</h2>
        <div class="form-group">
            <label for="userName">åå‰:</label>
            <input type="text" id="userName" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›">
        </div>
        <div class="form-group">
            <label for="userEmail">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</label>
            <input type="email" id="userEmail" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›">
        </div>
        <div class="form-group">
            <label for="userPhone">é›»è©±ç•ªå·:</label>
            <input type="text" id="userPhone" placeholder="é›»è©±ç•ªå·ã‚’å…¥åŠ›">
        </div>
        <button onclick="createUser()">ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ</button>
        <button onclick="getUsers()">ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§æ›´æ–°</button>
        
        <div id="usersDisplay" class="data-display">
            <h3>ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§</h3>
            <div id="usersList">ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãã ã•ã„</div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ“ ãƒ­ã‚°ç®¡ç†</h2>
        <div class="form-group">
            <label for="logLevel">ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«:</label>
            <select id="logLevel">
                <option value="INFO">INFO</option>
                <option value="WARN">WARN</option>
                <option value="ERROR">ERROR</option>
                <option value="DEBUG">DEBUG</option>
            </select>
        </div>
        <div class="form-group">
            <label for="logMessage">ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</label>
            <textarea id="logMessage" placeholder="ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›"></textarea>
        </div>
        <div class="form-group">
            <label for="logUserId">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID (ã‚ªãƒ—ã‚·ãƒ§ãƒ³):</label>
            <input type="number" id="logUserId" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å…¥åŠ›ï¼ˆç©ºæ¬„å¯ï¼‰">
        </div>
        <button onclick="createLog()">ãƒ­ã‚°ä½œæˆ</button>
        <button onclick="getLogs()">ãƒ­ã‚°ä¸€è¦§æ›´æ–°</button>
        
        <div id="logsDisplay" class="data-display">
            <h3>ãƒ­ã‚°ä¸€è¦§</h3>
            <div id="logsList">ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ãã ã•ã„</div>
        </div>
    </div>

    <script>
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«æ¥ç¶šç¢ºèª
        window.onload = function() {
            checkConnection();
        };

        // æ¥ç¶šç¢ºèª
        async function checkConnection() {
            const statusDiv = document.getElementById('connectionStatus');
            statusDiv.className = 'status info';
            statusDiv.textContent = 'æ¥ç¶šç¢ºèªä¸­...';

            try {
                const response = await fetch('/api/users');
                if (response.ok) {
                    statusDiv.className = 'status success';
                    statusDiv.textContent = 'âœ… DBæ¥ç¶šæˆåŠŸï¼ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒæ­£å¸¸ã«æ¥ç¶šã•ã‚Œã¦ã„ã¾ã™ã€‚';
                } else {
                    statusDiv.className = 'status error';
                    statusDiv.textContent = 'âŒ DBæ¥ç¶šã‚¨ãƒ©ãƒ¼: ' + response.status + ' ' + response.statusText;
                }
            } catch (error) {
                statusDiv.className = 'status error';
                statusDiv.textContent = 'âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼: ' + error.message;
            }
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—
        async function getUsers() {
            const usersListDiv = document.getElementById('usersList');
            usersListDiv.innerHTML = 'ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...';

            try {
                const response = await fetch('/api/users');
                if (response.ok) {
                    const users = await response.json();
                    displayUsers(users);
                } else {
                    usersListDiv.innerHTML = 'ã‚¨ãƒ©ãƒ¼: ' + response.status + ' ' + response.statusText;
                }
            } catch (error) {
                usersListDiv.innerHTML = 'ã‚¨ãƒ©ãƒ¼: ' + error.message;
            }
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼è¡¨ç¤º
        function displayUsers(users) {
            const usersListDiv = document.getElementById('usersList');
            if (users.length === 0) {
                usersListDiv.innerHTML = '<p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã—ã¾ã›ã‚“</p>';
                return;
            }

            let html = '';
            users.forEach(user => {
                const createdTime = new Date(user.createdAt || user.created_timestamp || user.created_at).toLocaleString('ja-JP');
                const updatedTime = new Date(user.updatedAt || user.updated_timestamp || user.updated_at).toLocaleString('ja-JP');
                
                html += `
                    <div class="user-card">
                        <h4>${user.name}</h4>
                        <p><strong>ID:</strong> ${user.id}</p>
                        <p><strong>ãƒ¡ãƒ¼ãƒ«:</strong> ${user.email}</p>
                        <p><strong>é›»è©±ç•ªå·:</strong> ${user.phone || 'æœªè¨­å®š'}</p>
                        <p class="timestamp"><strong>ä½œæˆæ—¥æ™‚:</strong> ${createdTime}</p>
                        <p class="timestamp"><strong>æ›´æ–°æ—¥æ™‚:</strong> ${updatedTime}</p>
                        <button onclick="deleteUser(${user.id})">å‰Šé™¤</button>
                    </div>
                `;
            });
            usersListDiv.innerHTML = html;
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
        async function createUser() {
            const name = document.getElementById('userName').value;
            const email = document.getElementById('userEmail').value;
            const phone = document.getElementById('userPhone').value;

            if (!name || !email) {
                alert('åå‰ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯å¿…é ˆã§ã™');
                return;
            }

            try {
                const response = await fetch('/api/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ name, email, phone })
                });

                if (response.ok) {
                    alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä½œæˆã•ã‚Œã¾ã—ãŸ');
                    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                    document.getElementById('userName').value = '';
                    document.getElementById('userEmail').value = '';
                    document.getElementById('userPhone').value = '';
                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’æ›´æ–°
                    getUsers();
                } else {
                    alert('ã‚¨ãƒ©ãƒ¼: ' + response.status + ' ' + response.statusText);
                }
            } catch (error) {
                alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤
        async function deleteUser(userId) {
            if (!confirm('ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                return;
            }

            try {
                const response = await fetch(`/api/users/${userId}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ');
                    getUsers();
                } else {
                    alert('ã‚¨ãƒ©ãƒ¼: ' + response.status + ' ' + response.statusText);
                }
            } catch (error) {
                alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }

        // ãƒ­ã‚°ä¸€è¦§å–å¾—
        async function getLogs() {
            const logsListDiv = document.getElementById('logsList');
            logsListDiv.innerHTML = 'ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­...';

            try {
                const response = await fetch('/api/logs');
                if (response.ok) {
                    const logs = await response.json();
                    displayLogs(logs);
                } else {
                    logsListDiv.innerHTML = 'ã‚¨ãƒ©ãƒ¼: ' + response.status + ' ' + response.statusText;
                }
            } catch (error) {
                logsListDiv.innerHTML = 'ã‚¨ãƒ©ãƒ¼: ' + error.message;
            }
        }

        // ãƒ­ã‚°è¡¨ç¤º
        function displayLogs(logs) {
            const logsListDiv = document.getElementById('logsList');
            if (logs.length === 0) {
                logsListDiv.innerHTML = '<p>ãƒ­ã‚°ãŒå­˜åœ¨ã—ã¾ã›ã‚“</p>';
                return;
            }

            let html = '';
            logs.forEach(log => {
                const createdTime = new Date(log.createdTimestamp || log.created_timestamp).toLocaleString('ja-JP');
                const updatedTime = new Date(log.updatedTimestamp || log.updated_timestamp).toLocaleString('ja-JP');
                
                html += `
                    <div class="user-card">
                        <h4>${log.level}</h4>
                        <p><strong>ID:</strong> ${log.id}</p>
                        <p><strong>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</strong> ${log.message}</p>
                        <p><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID:</strong> ${log.userId || log.user_id || 'ã‚·ã‚¹ãƒ†ãƒ '}</p>
                        <p class="timestamp"><strong>ä½œæˆæ—¥æ™‚:</strong> ${createdTime}</p>
                        <p class="timestamp"><strong>æ›´æ–°æ—¥æ™‚:</strong> ${updatedTime}</p>
                    </div>
                `;
            });
            logsListDiv.innerHTML = html;
        }

        // ãƒ­ã‚°ä½œæˆ
        async function createLog() {
            const level = document.getElementById('logLevel').value;
            const message = document.getElementById('logMessage').value;
            const userId = document.getElementById('logUserId').value;

            if (!message) {
                alert('ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯å¿…é ˆã§ã™');
                return;
            }

            const logData = { level, message };
            if (userId) {
                logData.userId = parseInt(userId);
            }

            try {
                const response = await fetch('/api/logs', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(logData)
                });

                if (response.ok) {
                    alert('ãƒ­ã‚°ãŒä½œæˆã•ã‚Œã¾ã—ãŸ');
                    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                    document.getElementById('logMessage').value = '';
                    document.getElementById('logUserId').value = '';
                    // ãƒ­ã‚°ä¸€è¦§ã‚’æ›´æ–°
                    getLogs();
                } else {
                    alert('ã‚¨ãƒ©ãƒ¼: ' + response.status + ' ' + response.statusText);
                }
            } catch (error) {
                alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
            }
        }
    </script>
</body>
</html>
